clear all, clc

%DEFINE DATASET
y_antigo = [1,2,3,4,3,2,1,2,3,4,3,2,1]';
% y_antigo = [-0.00102531950789011 0.0130796054941718 0.0271831194962334 0.0412838134982946 0.0553802765003553 0.0694710985024151 0.0835548715044738 0.0976301865065314 0.111695640508587 0.125749810510642 0.139791310512695 0.153818730514745 0.167830660516793 0.181825710518839 0.195802480520882 0.209759560522922 0.223695560524960 0.237609090526994 0.251498760529024 0.265363170531051 0.279200950533073 0.293010710535092 0.306791060537107 0.320540630539116 0.334258040541122 0.347941920543122 0.361590910545117 0.375203640547107 0.388778750549092 0.402314870551070 0.415810660553043 0.429264770555010 0.442675850556970 0.456042560558924 0.469363560560871 0.482637530562812 0.495863120564745 0.509039040566671 0.522163940568590 0.535236530570501 0.548255490572404 0.561219520574299 0.574127330576186 0.586977620578064 0.599769110579934 0.612500530581795 0.625170590583647 0.637778030585490 0.650321600587324 0.662800030589148 0.675212080590962 0.687556500592767 0.699832070594561 0.712037550596346 0.724171730598119 0.736233380599883 0.748221310601635 0.760134320603376 0.771971220605107 0.783730810606826 0.795411930608533 0.807013400610229 0.818534070611913 0.829972790613585 0.841328410615245 0.852599790616893 0.863785810618528 0.874885350620151 0.885897310621760 0.896820560623357 0.907654040624941 0.918396650626511 0.929047310628068 0.939604970629611 0.950068570631141 0.960437060632657 0.970709410634158 0.980884580635646 0.990961560637119 1.00093938063858 1.01081688064002 1.02059338064145 1.03026758064286 1.03983868064426 1.04930568064565 1.05866768064702 1.06792378064837 1.07707288064971 1.08611418065103 1.09504678065233 1.10386978065362 1.11258238065490 1.12118348065615 1.12967248065740 1.13804828065862 1.14631028065983 1.15445748066102 1.16248918066219 1.17040448066335 1.17820268066449];

% test_forecast


% NOTA IMPORTANTE: Ainda não vi nenhum caso em que, com p=0, o programa não
% desse erro! É o parâmetro mais preponderante!



% 3AC0021C
% y_antigo = [11 14 28 37 43 52 62 71 76 85 93 103 105 110 117 115 114 118 121 119 118 117 114 118 118 118 118 121 125 125 127 127 129 130 126 129 127 129 131 134 133 135 136 130 129 126 124 118 115 103 92 110 107 110 123 123 135 130]';
% (7,0,1), mas não consegue convergir... Com estes dados, d=1 até piora...

% 3AC0324A
% y_antigo = [9;16;29;34;35;37;41;46;49;47;48;48;46;43;42;44;43;42;44;43;45;46;46;43;42;42;42;42;41;41;42;42;42;42;46;47;51;54;54;55;56;54;54;47;50;50;36;38;34;34;40;59;64;44;37];

% 3AC0324B
% y_antigo = [7;9;16;23;28;31;30;30;33;34;35;44;47;52;53;56;59;67;68;71;72;79;77;77;76;74;74;76;72;75;77;79;79;82;87;90;89;93;96;93;89;88;77;69;61;59;57;54;66;56;58;58;77;87;89;72;56;45];
% Melhor em (4,0,1), para não ir demasiado atrás e ser influenciado pelos primeiros valores. Mas só tende para a média.

% 3AC0324D
% y_antigo = [4;5;9;9;16;24;33;37;38;41;50;52;56;60;65;68;68;66;65;64;64;65;65;66;67;67;68;68;67;66;65;64;64;63;61;57;53;52;49;48;51;49;51;40;40;59;55;41;39;36;39];
% Melhor em (7,0,0)

% NZAlcoholConsumption, TotalBeer
% y_antigo = [2.95700000000000;2.82300000000000;2.79800000000000;3.99700000000000;3.03700000000000;2.77800000000000;2.85700000000000;3.96700000000000;3.09400000000000;2.81900000000000;3.05200000000000;4.08800000000000;3.04400000000000;2.84900000000000;3.13700000000000;4.04000000000000;3.33700000000000;2.72600000000000;3.13500000000000;3.90400000000000;3.22200000000000;3.05800000000000;2.99200000000000;4.02500000000000;3.02700000000000;2.79600000000000;2.92100000000000;4.25600000000000;3.16900000000000;2.87000000000000;2.86400000000000;4.26700000000000;3.39900000000000;3.29600000000000;2.78000000000000;4.16600000000000;3.16200000000000;2.94000000000000;2.84600000000000;4.02400000000000;3.30100000000000;2.82600000000000;2.71200000000000;3.93400000000000;3.19200000000000;2.97500000000000;2.86500000000000;3.78900000000000;2.72800000000000;2.84000000000000;2.63300000000000];
% (5,0,1) = (5,0,0)
% Com (6,0,1), nota-se que R se adapta mais suavemente, ainda que o nosso talvez faça melhor (mas já começa a denotar divergência). Com (7,0,1), já é divergente.

% NZAlcoholConsumption, TotalSpirits
% y_antigo = [1.09700000000000;1.30900000000000;1.49600000000000;1.81000000000000;1.24000000000000;1.51600000000000;1.27200000000000;1.75100000000000;1.27600000000000;1.37800000000000;1.51200000000000;2.05500000000000;1.25700000000000;1.49400000000000;1.38600000000000;1.97400000000000;1.52900000000000;1.44400000000000;1.74600000000000;2.13000000000000;1.46400000000000;1.77100000000000;1.52200000000000;2.31000000000000;1.44300000000000;1.86500000000000;1.86100000000000;2.27200000000000;1.43400000000000;1.85200000000000;1.72200000000000;2.33700000000000;1.72200000000000;2.22200000000000;1.67100000000000;2.42100000000000;1.54700000000000;1.86400000000000;1.67100000000000;3.10100000000000;1.97000000000000;2.06200000000000;2.24300000000000;3.05400000000000;2.00300000000000;2.64500000000000;2.48200000000000;2.56600000000000;2.06100000000000;2.71500000000000;2.25200000000000];
% BOM EXEMPLO DE ARMA! (8,0,1)

% NZAlcoholConsumption, TotalWine
% y_antigo = [1.48600000000000;1.91500000000000;1.84400000000000;2.80800000000000;1.28700000000000;1.86100000000000;2.03400000000000;2.73900000000000;1.65600000000000;1.91800000000000;2.26500000000000;2.90200000000000;1.69100000000000;2.03300000000000;2.14100000000000;2.93200000000000;1.84700000000000;2.15700000000000;2.31800000000000;2.97400000000000;1.97700000000000;2.32800000000000;2.47900000000000;3.09900000000000;2.14100000000000;2.29900000000000;2.60600000000000;3.33000000000000;2.29000000000000;2.49900000000000;2.52400000000000;2.88700000000000;2.00700000000000;2.33000000000000;2.38400000000000;3.69600000000000;2.15700000000000;2.52900000000000;2.39500000000000;3.44700000000000;2.49900000000000;2.49900000000000;2.50400000000000;3.83400000000000;2.24600000000000;2.53800000000000;2.70400000000000;3.32100000000000;2.43300000000000;2.67300000000000;2.64700000000000];
% (4,1,1), (4,0,1), qual melhor? Segundo R, (4,1,1), pq tende para a média, mas tem de se ver...

% power_data
% y_antigo = csvread('power_data.csv');
% dados muito grandes. Com y_antigo(end-101:end-1), fica melhor com p=10, mas só tende para a média

% WIKI FB
%y_antigo = [37000836;32403527;26904158;43391719;41887638;36597388;21807110;19065985;18225601;15857398;20215704;23067057;18925097;24488581;27825733;28057010;18602170;21645890;30705140;30980750;25546020;18871220;24080429;36871429;45745530;22334813;25227937;18395055;17189887;20719657;15753368;16163037;20996472;20132213;26891865;41814496;42485679;60519095;47619135;19229120;16711610;19491720;24911680;22756818;34012354;25817706;25111335;19136908;23898687;27340533;25934990;18133336;19968814;14352687;10623101;7684481;19824474;31299078;43150164;34103582;29109494;31443611;29324006;32096414;25283447;24245255;14359961;16725242;31644957;15991872;32651841;32232887;22080500;23039660;19127242;25391184;20629128;28669580;19416910;26408940;26497580;18702040;21526460;20739813;21287749;39145804;40390871;44403970;83051219;105638828;59013760;29745769;32093898;34813094;41799140;32176370;34442273;69309246;53348315;61279193;50015670;43785216;51958892;32230403;32066827;25220515;25679100;23260013;36371609;54941808;34541358;33940207;28749318;37358532;30608503;36630348;31873144;76336490;22905945;28477657;37593839;49498661;26631452;32140918;29755080;28676780;28092891;29301160;26496727;32273040;34722938;26193240;21873276;36178976;23695867;19687626;20800976;20041059;22850033;26596500;23898550;38837920;22163750;29129184;27304335;24513959;26995913;38012637;30834846;34865986;30553483;43346324;43731204;36349800;40822659;41516029;45705473;122922493;70986659;40144676;49240427;42132424;37850859;29496133;44106652;38360031;39098152;44324925;51271818;68788007;28653101;25199590;41719402;33119511;27026316;45134317;47593536;44085201;57225771;34424160;46074356;34126766;35413283;27616599;30841841;29294917;55541785;44104030;68995285;37216220;42365430;47219709;36431050;32052513;35918301;45118958;42272955;47691434;55501423;38153029;54038527;58718499;53732162;42994992;47796814;56498435;47316870;48401876;48214948;52534292;61143360;78308804;55621086;45833389;53942899;82273178;75508939;75177466;107485084;92108532;138547218;86451911;60180264;59838212;87880603;78197945;108415391;72253635;91276811;114760052;100011100;78746900;108337900;125214400;83683000;66165100;59124800;52927400;66924900;112650000;97503900;68786000;85696000;60041000;44439000;43981000;40827000;52197000;48227000;57091000;46400000;59615000;59871600;38927000;46026500;74567700;42013500;56824100;66783700;41653700;55322700;52077000;76620300;70932400;130928900;62087100;43809900;36694900;61911700;47282100;45675600;43666100;60704300;42086500;51685100;45985500;74866600;87794600;150178900;92995600;48191200;73924100;55200700;47951800;61352900;48669200;40849200;34541800;33663400;37503600;63010900;42449500;92253300;56682400;77207400;68852600;38246200;43195500;43076200;68307000;60466000;55101000;46617800;98297000;239824000;89825000;76003000;78751000;85119000;82641000;92723000;65776000;68479000;36056000;42938000;43855000;60489500;32086000;50774000;22953900;44993000;82016000;82565000;40545000;34886000;53933000;75602000;85910000;42453000;75117000;79245000;68196000;80910000;70731000;97128000;67889000;76835000;80371000;95033000;248809000;127073000;102143000;73472000;45085000;46775000;57207000;83204000;58235000;88260000;71522000;64678000;81167000;68781000;58428000;99774000;147297000;136081000;57204000;74447000;82045000;62834000;98114000;100095000;81410500;98220100;87879700;136716100;75177000;115508400;63972400;79317000;91934600;70424200;52765300;68072300;72328300;54540300;75794700;117535700;50035400;42581900;48774900;67735100;58303400;57918200;72695100;94162400;86442300;21931200;46116900;57995200;57609600;45840800;56521100;48423900;65379200;31161000;43532300;41301000;68854800;63950800;79994800;73058500;106066500;154828700;173582800;124718800;136028900;365457900;82635600;28221600;27526300;46539700;24806900;21518500;30817600;24234000;16537900;26777400;26721800;30387900;27064600;20229500;10404400;18394100;20582200;96778900;34694100;29890300;24713200;40626000;45833900;42765600;31790600;36709100;33664500;30677100;31189300;26445800;29885900;58393000;38699200;31260700;53819700;34760800;35733800;35925000;60733200;64237800;50079700;58727900;37663100;45314500;26261300;42402900;29462700;35499100;30299800;24930300;29068800;30847100;33457200;34654900;41259100;43939400;58506400;104257000;64567600;36245700;29201100;33018000;17150000;19729900;25191500;25687600;20380900;39059000;26440600;27365900;30275400;28697400;33368500;45949400;21311100;27256000;64566600;82016800;48195200;35153300;22249300;28585700;52297400;26957200;39199000;18456300;24336100;44006500;25254200;26653700;31597400;27646400;39619500;27569600;35642100;44198900;74540200;33532600;40622200;32400700;54064800;83027800;44319700;31611700;34652000;36350200;49642300;42098200;49396400;33109300;35615800;50164000;93447800;37361800;37708800;34540100;38375900;47948200;92362200;85856700;190744900;87682100;72976500;59682500;54363600;43845100;48899800;55243300;49631500;40256700;75332700;173242600;98892800;89598000;95316400;104787700;45871300;83781800;72715400;63140600;69846400;60374500;56574800;43481700;33175400;28230100;54555200;35574800;61390300;60512900;57742500;91631600;81051600;46704200;77099100;50608500;51751900;46001500;58976300;72869200;123526100;127049600;88759700;49205600;85760600;123865000;29520900;89862400;46655300;85021300;107182200;78857700;229751000;71775100;67349200;42295500;34254600;33396800;29062700;31806700;38344400;37713900;99378200;73259600;76142000;228949900;78381200;32447300;34835000;52157400;44074500;21834700;20189700;18809400;21817300;39321800;27161800;32236700;40529300;46892100;32000100;29341400;51262700;65486000;30215900;38271900;46291700;79106500;51218100;57248900;78782800;36760500;50667600;72819800;65041600;121584000;50508200;24797800;36371700;46066500;60781800;46622400;58764200;30647500;16124700;25417000;20704000;29622200;32813700;49892200;70640600;101186600;129293400;157565300;47861100;39308800;24973100;25794700;15610700;29537400;36782900;27778900;80647000;56374500;44604400;56179400;29285900;123102300;64597400;17230200;11539800;12390700;11869100;13685100;16841800;30438600;24672100;8108300;11300700;13030300;14269500;17785200;10945600;10032100;8763600;14122000;19526900;17713300;28568000;24858700;24352900;74834000;21875300;15553600;30849000;42978900;43563800;16855000;17102800;15816800;28219600;38034000;26159500;61489200;42473400;35230300;41855500;111639200;57267900;78063400;37149800;50237200;73600000;101786600;168192700;573576400];
% dados muito grandes. Com y_antigo(end-101:end-1), fica melhor com p=10, mas só tende para a média


% figure(), parcorr(y_antigo)
% figure(), autocorr(y_antigo)


numPrev = 40;

p=4;
d=0;
q=0;



[ y_past, y_predict, resid, lowerConf95, upperConf95, ARcoefs, MAcoefs ] = ARIMAteste1( p, d, q, y_antigo, numPrev );



%Figure stuff
figure()

hold on
plot(y_past,'b-o')

a = length(y_past)+1 : length(y_past)+length(y_predict);
plot( a,y_predict, 'r-o')

plot(a,upperConf95,'g-')
plot(a,lowerConf95,'g-')

grid
hold off

